<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ¢ Python Turtle Playground (Static)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bulmaï¼ˆä»…æ ·å¼ï¼Œéå¿…é¡»ï¼Œå¯æ”¹ä¸ºæœ¬åœ°ï¼‰ -->
  <link rel="stylesheet" href="./style/bulma.min.css">
  <link rel="stylesheet" href="./style/animate.min.css"/>

  <link rel="stylesheet" href="./style/layout.css">
  <link rel="stylesheet" href="./style/theme.css">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@9.1.1/dist/css/shepherd.css" />
  <script src="https://cdn.jsdelivr.net/npm/shepherd.js@9.1.1/dist/js/shepherd.min.js"></script>

  <!-- æœ¬åœ° Monacoï¼šè¯·ç¡®ä¿ monaco/vs/ å­˜åœ¨ -->
  <script src="monaco/vs/loader.js"></script>
</head>
<body>

  <nav class="navbar" role="navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="#" style="color:#61dafb; font-weight:700;">ğŸ¢ Turtle Playground</a>
      <button id="startTourBtn" class="button is-info is-small">ğŸ“ æ•™å­¦</button>
    </div>
  </nav>

  <section class="section">
    <div class="container">
      <div class="columns is-variable is-6">
        <!-- å·¦ä¾§ï¼šç¼–è¾‘å™¨ä¸æ§åˆ¶ -->
        <div class="column is-half  animate__animated animate__fadeInLeft">
            <h2 class="subtitle is-5">ç¼–è¾‘ Python ä»£ç </h2>
          <div id="editor-container"></div>

          <div class="buttons mt-3">
            <button id="runBtn" class="button is-primary">â–¶ è¿è¡Œ</button>
            <button id="stopBtn" class="button is-danger is-light">â¹ åœæ­¢/æ¸…ç©º</button>
            <button id="saveBtn" class="button is-link is-light">ğŸ’¾ ä¿å­˜</button>
            <div class="select is-small" style="margin-left:8px;">
              <select id="examplesSelect" title="ç¤ºä¾‹ä»£ç ">
                <option value="">ç¤ºä¾‹ï¼šé€‰æ‹©ä¸€ä¸ªç¤ºä¾‹åŠ è½½</option>
                <option value="square">æ­£æ–¹å½¢</option>
                <option value="spiral">å½©è‰²èºæ—‹</option>
                <option value="star">äº”è§’æ˜Ÿ</option>
              </select>
            </div>
            

          </div>

          <div class="is-divider"></div>
          <h2 class="subtitle is-6">è¾“å‡º</h2>
          <pre id="output"></pre>
        </div>

        <!-- å³ä¾§ï¼šCanvas -->
        <div class="column is-half animate__animated animate__fadeInRight">
          <h2 class="subtitle is-5">ç»˜å›¾åŒºåŸŸ</h2>
          <div id="turtle-area" class="box">
            <div id="turtle-canvas"></div>
          </div>
        </div>
      </div>

    </div>
  </section>

  
  <script src="./script/examples.js"></script>
  <!-- åŠ è½½å¤–éƒ¨ snippets.js æ–‡ä»¶ -->
  <script src="./script/snippets.js"></script>
  <script>
    // é…ç½® Monaco çš„ AMD è·¯å¾„
    require.config({ paths: { 'vs': 'monaco/vs' } });
    let editor;


    // åˆå§‹åŒ– Monaco
    require(['vs/editor/editor.main'], function () {
      // åˆå§‹ä»£ç ï¼ˆä¼˜å…ˆä» localStorage æ¢å¤ï¼‰
      const saved = localStorage.getItem('turtle_code');
      const initial = saved || `from turtle import *
speed(8)

# ç”»ä¸€ä¸ªæ­£æ–¹å½¢
color("deepskyblue")
for i in range(4):
    forward(100)
    right(90)

penup()
goto(-50, -50)
pendown()
color("red")
circle(40)

done()`;

      editor = monaco.editor.create(document.getElementById('editor-container'), {
        value: initial,
        language: 'python',
        theme: 'vs-light',
        automaticLayout: true,
        fontSize: 14,
        minimap: { enabled: false },
        tabSize: 4,
        insertSpaces: true,
        smoothScrolling: true,
        scrollBeyondLastLine: false
      });

      // ç®€å•çš„ Turtle ç‰‡æ®µä¸è¡¥å…¨
      monaco.languages.registerCompletionItemProvider('python', {
        provideCompletionItems: function(model, position) {
          const suggestions = window.createPythonSnippets(monaco);
          return { suggestions };
        }
      });

      // ç¤ºä¾‹é€‰æ‹©
      const examplesSelect = document.getElementById('examplesSelect');
      examplesSelect.addEventListener('change', () => {
        const key = examplesSelect.value;
        if (key && EXAMPLES[key]) {
          editor.setValue(EXAMPLES[key]);
        }
      });
    });
  </script>

  <!-- æœ¬åœ° Skulptï¼šè¯·ç¡®ä¿ script/ ä¸‹ä¸¤ä¸ªæ–‡ä»¶å­˜åœ¨ -->
  <script src="script/skulpt.min.js"></script>
  <script src="script/skulpt-stdlib.js"></script>
  <script>
    const outEl = document.getElementById("output");
    const runBtn = document.getElementById("runBtn");
    const stopBtn = document.getElementById("stopBtn");
    const saveBtn = document.getElementById("saveBtn");
    const canvasTargetId = "turtle-canvas";

    function outf(text) { outEl.textContent += text; }
    function clearOut() { outEl.textContent = ""; }

    function builtinRead(x) {
      if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined) {
        throw "File not found: '" + x + "'";
      }
      return Sk.builtinFiles["files"][x];
    }

    function resetCanvas() {
      const tgt = document.getElementById(canvasTargetId);
      if (tgt) tgt.innerHTML = "";
    }

    async function runCode() {
      clearOut();
      resetCanvas();

      const prog = window.monaco ? monaco.editor.getModels()[0].getValue() : '';

      // ä¿å­˜ä»£ç åˆ° localStorage
      try { localStorage.setItem('turtle_code', prog); } catch (e) {}

      Sk.configure({
        output: outf,
        read: builtinRead,
        __future__: Sk.python3
      });

      Sk.TurtleGraphics = Sk.TurtleGraphics || {};
      Sk.TurtleGraphics.target = canvasTargetId;

      try {
        await Sk.misceval.asyncToPromise(() =>
          Sk.importMainWithBody("<stdin>", false, prog, true)
        );
        outf("\n[å®Œæˆ]\n");
      } catch (err) {
        outf("\n[é”™è¯¯] " + err.toString() + "\n");
        console.error(err);
      }
    }

    function stopAndClear() {
      resetCanvas();
      clearOut();
    }

    function saveCode() {
      const prog = window.monaco ? monaco.editor.getModels()[0].getValue() : '';
      try {
        localStorage.setItem('turtle_code', prog);
        outEl.textContent += "\n[å·²ä¿å­˜åˆ°æœ¬åœ°]";
      } catch (e) {
        outEl.textContent += "\n[ä¿å­˜å¤±è´¥]";
      }
    }

    runBtn.addEventListener("click", runCode);
    stopBtn.addEventListener("click", stopAndClear);
    saveBtn.addEventListener("click", saveCode);
  </script>
  <script>
    // æ›¿æ¢ Skulpt çš„ input() å¼¹çª—
    Sk.inputfun = function(promptText) {
      return new Promise((resolve, reject) => {
        const modal = document.getElementById("custom-input-modal");
        const inputField = document.getElementById("custom-input-field");
        const confirmBtn = document.getElementById("custom-input-confirm");
        const cancelBtn = document.getElementById("custom-input-cancel");
  
        inputField.value = "";
        modal.classList.add("is-active");
  
        confirmBtn.onclick = () => {
          modal.classList.remove("is-active");
          resolve(inputField.value);
        };
  
        cancelBtn.onclick = () => {
          modal.classList.remove("is-active");
          reject("ç”¨æˆ·å–æ¶ˆè¾“å…¥");
        };
  
        inputField.onkeydown = (e) => {
          if (e.key === "Enter") {
            confirmBtn.click();
          }
        };
  
        inputField.focus();
      });
    };
  </script>
  <script>
    document.getElementById('startTourBtn').addEventListener('click', () => {
      const tour = new Shepherd.Tour({
        defaultStepOptions: {
          cancelIcon: { enabled: true },
          classes: 'shepherd-theme-arrows',
          scrollTo: { behavior: 'smooth', block: 'center' }
        }
      });

      tour.addStep({
        title: 'ç¼–è¾‘å™¨åŒºåŸŸ',
        text: 'åœ¨è¿™é‡Œå†™ä½ çš„ Python turtle ä»£ç ã€‚',
        attachTo: { element: '#editor-container', on: 'bottom' },
        buttons: [{ text: 'ä¸‹ä¸€æ­¥', action: tour.next }]
      });

      tour.addStep({
        title: 'è¿è¡ŒæŒ‰é’®',
        text: 'ç‚¹å‡»è¿è¡Œ,ä½ çš„ä»£ç ä¼šåœ¨å³ä¾§ç»˜å›¾åŒºåŸŸå±•ç¤ºæ•ˆæœã€‚',
        attachTo: { element: '#runBtn', on: 'bottom' },
        buttons: [{ text: 'ä¸‹ä¸€æ­¥', action: tour.next }]
      });

      tour.addStep({
        title: 'ç»˜å›¾åŒºåŸŸ',
        text: 'è¿™é‡Œæ˜¯ turtle ç»˜å›¾çš„å±•ç¤ºåŒºã€‚',
        attachTo: { element: '#turtle-area', on: 'bottom' },
        buttons: [{ text: 'å®Œæˆ', action: tour.complete }]
      });

      tour.start();
  });

  </script>
  
  <!-- è‡ªå®šä¹‰è¾“å…¥æ¡†æµ®å±‚ -->
<div id="custom-input-modal" class="modal">
  <div class="modal-background"></div>
  <div class="modal-card">
    <header class="modal-card-head">
      <p class="modal-card-title">è¯·è¾“å…¥</p>
    </header>
    <section class="modal-card-body">
      <input id="custom-input-field" class="input" type="text" placeholder="è¾“å…¥å†…å®¹â€¦" />
    </section>
    <footer class="modal-card-foot">
      <button id="custom-input-confirm" class="button is-primary">ç¡®è®¤</button>
      <button id="custom-input-cancel" class="button is-light">å–æ¶ˆ</button>
    </footer>
  </div>
</div>

<div id="focus-overlay"></div>

</body>
</html>
